<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€åŸŸæ‹‰éœ¸æ©Ÿ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #fffce0;
        text-align: center;
        padding: 50px;
        min-height: 100vh; /* ç¢ºä¿èƒŒæ™¯è‡³å°‘è¦†è“‹æ•´å€‹è¦–çª—é«˜åº¦ */
        margin: 0; /* ç§»é™¤é è¨­é‚Šè· */

        /* ======= èƒŒæ™¯åœ–è¨­å®šé–‹å§‹ ======= */
        background-image: url('./003.png'); /* æŒ‡å®šåœ–ç‰‡è·¯å¾‘ï¼Œå‡è¨­åœ–ç‰‡åœ¨ index.html åŒä¸€ç›®éŒ„ */
        background-repeat: no-repeat;       /* èƒŒæ™¯åœ–ç‰‡ä¸é‡è¤‡ */
        background-position: center center; /* åœ–ç‰‡æ°´å¹³å’Œå‚ç›´éƒ½ç½®ä¸­ */
        background-attachment: fixed;       /* è®“èƒŒæ™¯åœ–å›ºå®šï¼Œä¸éš¨é é¢æ²å‹•è€Œç§»å‹• */
        background-size: 300px 200px;       /* *** åœ¨é€™è£¡è¨­å®šåœ–ç‰‡çš„å›ºå®šå¯¬åº¦å’Œé«˜åº¦ *** */
        /* ======= èƒŒæ™¯åœ–è¨­å®šçµæŸ ======= */
      }

      h1 {
        color: #c00;
        margin-bottom: 40px;
      }

      .slot-machine-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 40px;
        gap: 30px;
      }

      .reel-box {
        width: 200px;
        height: 60px;
        border: 3px solid #000;
        border-radius: 10px;
        background: #fff;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.2); /* æ·»åŠ é™°å½±å¢åŠ ç«‹é«”æ„Ÿ */
      }

      button {
        margin: 10px;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        background-color: #ff9900;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease; /* æŒ‰éˆ•å¹³æ»‘éæ¸¡æ•ˆæœ */
      }

      button:hover {
        background-color: #e68a00; /* æŒ‰éˆ•æ‡¸åœæ•ˆæœ */
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      #resetHistoryButton {
        background-color: #666;
      }
      #resetHistoryButton:hover {
        background-color: #555;
      }

      #restartButton {
        background-color: #0066cc;
      }
      #restartButton:hover {
        background-color: #005bb5;
      }

      #musicToggleButton {
        background-color: #4CAF50; /* ç¶ è‰² */
        position: fixed; /* å›ºå®šåœ¨è¢å¹•ä¸Š */
        top: 20px;
        right: 20px;
        padding: 10px 15px;
        font-size: 14px;
        z-index: 1000; /* ç¢ºä¿æŒ‰éˆ•åœ¨å…¶ä»–å…§å®¹ä¹‹ä¸Š */
      }
      #musicToggleButton:hover {
        background-color: #45a049;
      }


      #result {
        margin-top: 30px;
        font-size: 18px;
        color: #333;
        min-height: 40px; /* ç¢ºä¿çµæœå€æœ‰è¶³å¤ é«˜åº¦ï¼Œé¿å…å…§å®¹è·³å‹• */
      }

      #result b {
        color: #003366;
      }

      #history {
        margin-top: 40px;
        text-align: left;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        background: rgba(255, 255, 255, 0.8); /* æ­·å²ç´€éŒ„å€å¡ŠåŠé€æ˜ï¼Œèƒ½çœ‹åˆ°èƒŒæ™¯åœ– */
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #ccc;
        min-height: 100px;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        overflow-y: auto; /* ç´€éŒ„å¤šæ™‚å¯ä»¥æ²å‹• */
        max-height: 250px; /* è¨­å®šæœ€å¤§é«˜åº¦ */
      }

      #history strong {
        color: #c00;
        display: block; /* è®“æ¨™é¡Œç¨ç«‹ä¸€è¡Œ */
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }

      #history div {
        margin-bottom: 5px;
        padding-left: 10px;
        border-left: 3px solid #ff9900;
      }
    </style>
  </head>
  <body>
    <audio id="backgroundMusic" src="./002.mp3" loop preload="auto"></audio>
    <button id="musicToggleButton" onclick="toggleMusic()">ğŸµ éŸ³æ¨‚é–‹ / é—œ</button>

    <h1>ğŸ° å€åŸŸæ‹‰éœ¸æ©Ÿ</h1>

    <div class="slot-machine-wrapper">
      <div id="areaReel" class="reel-box">--</div>
      <div id="numberReel" class="reel-box">--</div>
    </div>

    <button id="drawButton" onclick="startDraw()">é–‹å§‹æŠ½é¸</button>
    <button id="retryNumberButton" onclick="retryNumber()" disabled>é‡æŠ½ç›®å‰ç·¨è™Ÿ</button>
    <button id="resetHistoryButton" onclick="resetHistory()">æ¸…é™¤ç´€éŒ„</button>
    <button id="restartButton" onclick="restartAll()">ğŸ”„ é‡æ–°é–‹å§‹</button>

    <div id="result"></div>
    <div id="history"><strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong></div>

    <script>
      // ====================================================================
      // *** é€™æ˜¯æ ¹æ“šæ‚¨æä¾›çš„æœ€æ–°è³‡æ–™ç”Ÿæˆçš„ `areaMap` å’Œ `areaNames` ***
      // ====================================================================
      let areaMap = {
        "å¤§å¾·": ["002å€", "003å€"],
        "ä¸­å’Œ": [
          "001å€", "002å€", "003å€", "004å€", "005å€", "006å€", "007å€", "008å€",
          "010å€", "011å€", "012å€", "013å€", "014å€", "017å€", "018å€", "019å€",
          "020å€", "021å€", "022å€", "023å€", "024å€", "025å€", "026å€", "027å€",
          "028å€", "029å€", "030å€", "031å€", "032å€", "033å€", "034å€", "035å€",
          "036å€", "038å€", "039å€", "040å€", "041å€", "042å€", "043å€", "044å€",
          "045å€", "047å€", "048å€", "049å€", "050å€", "051å€", "052å€", "053å€",
          "054å€", "055å€", "056å€", "057å€", "058å€", "059å€", "062å€", "063å€",
          "064å€", "065å€", "066å€", "067å€", "068å€", "069å€", "070å€", "071å€",
          "072å€", "075å€", "076å€", "077å€", "078å€", "080å€", "081å€", "082å€",
          "083å€", "084å€", "085å€", "087å€", "088å€", "089å€", "090å€", "092å€",
          "093å€", "094å€", "095å€", "096å€", "097å€", "098å€", "099å€", "100å€",
          "101å€", "102å€", "103å€", "104å€", "105å€", "106å€", "107å€", "108å€",
          "109å€", "110å€", "111å€", "112å€", "113å€", "114å€", "115å€", "117å€",
          "118å€"
        ],
        "æ–‡åŒ–å‚³æ’­": ["001å€"],
        "æ­£å®—": ["001å€", "002å€", "003å€", "005å€", "006å€", "007å€", "008å€"],
        "å´‡æ­£å€": [],
        "é€šåŒ–": ["001å€", "002å€", "003å€", "005å€"],
        "è¯å¾·": ["001å€", "002å€", "003å€", "004å€", "005å€", "006å€"],
        "ç²¾æ˜": ["001å€", "002å€", "011å€", "013å€", "018å€", "022å€", "024å€"],
        "è³¢å¾·": ["001å€", "002å€", "003å€"]
      };

      let areaNames = [
        "å¤§å¾·", "ä¸­å’Œ", "æ–‡åŒ–å‚³æ’­", "æ­£å®—", "å´‡æ­£å€", "é€šåŒ–", "è¯å¾·", "ç²¾æ˜", "è³¢å¾·"
      ];

      // ====================================================================

      let drawnMap = {};
      let lastSelectedArea = null;
      let backgroundMusic = document.getElementById('backgroundMusic');
      let musicToggleBtn = document.getElementById('musicToggleButton');
      let isMusicPlaying = false; // è¿½è¹¤éŸ³æ¨‚æ’­æ”¾ç‹€æ…‹

      // å˜—è©¦åœ¨ç¶²é è¼‰å…¥æ™‚æ’­æ”¾éŸ³æ¨‚ï¼Œä½†ç€è¦½å™¨å¯èƒ½é˜»æ­¢
      // ç‚ºäº†è§£æ±ºè‡ªå‹•æ’­æ”¾é™åˆ¶ï¼Œæˆ‘å€‘æ”¹ç”¨ä½¿ç”¨è€…äº’å‹•ä¾†è§¸ç™¼æ’­æ”¾
      // backgroundMusic.play().catch(error => {
      //     console.log('éŸ³æ¨‚è‡ªå‹•æ’­æ”¾è¢«é˜»æ­¢:', error);
      //     // å¦‚æœè‡ªå‹•æ’­æ”¾è¢«é˜»æ­¢ï¼Œå¯ä»¥è€ƒæ…®çµ¦äºˆä½¿ç”¨è€…æç¤ºæˆ–é¡¯ç¤ºæ’­æ”¾æŒ‰éˆ•
      // });

      // ç•¶ä½¿ç”¨è€…é»æ“Šã€Œé–‹å§‹æŠ½é¸ã€æŒ‰éˆ•æ™‚ï¼Œå˜—è©¦æ’­æ”¾éŸ³æ¨‚ï¼ˆå¦‚æœå°šæœªæ’­æ”¾ï¼‰
      document.addEventListener('DOMContentLoaded', () => {
          // é¦–æ¬¡è¼‰å…¥æ™‚ï¼ŒéŸ³æ¨‚æ˜¯éœéŸ³çš„ï¼Œä¸¦é¡¯ç¤ºã€ŒéŸ³æ¨‚é–‹ã€
          backgroundMusic.muted = true;
          musicToggleBtn.textContent = 'ğŸµ éŸ³æ¨‚é–‹';
      });

      function toggleMusic() {
          if (backgroundMusic.muted) {
              backgroundMusic.muted = false; // å–æ¶ˆéœéŸ³
              backgroundMusic.play().catch(error => {
                  console.log('éŸ³æ¨‚æ’­æ”¾å¤±æ•—:', error);
                  alert('ç€è¦½å™¨é™åˆ¶è‡ªå‹•æ’­æ”¾éŸ³æ¨‚ï¼Œè«‹å…è¨±ç¶²ç«™æ’­æ”¾è²éŸ³ã€‚');
                  backgroundMusic.muted = true; // å¦‚æœæ’­æ”¾å¤±æ•—ï¼Œå†æ¬¡éœéŸ³
                  musicToggleBtn.textContent = 'ğŸµ éŸ³æ¨‚é–‹';
              });
              musicToggleBtn.textContent = 'ğŸ”‡ éŸ³æ¨‚é—œ';
              isMusicPlaying = true;
          } else {
              backgroundMusic.muted = true; // éœéŸ³
              musicToggleBtn.textContent = 'ğŸµ éŸ³æ¨‚é–‹';
              isMusicPlaying = false;
          }
      }

      function startDraw() {
        // å¦‚æœéŸ³æ¨‚æ˜¯éœéŸ³çš„ï¼Œä¸”æ’­æ”¾åŠŸèƒ½å…è¨±ï¼Œå˜—è©¦æ’­æ”¾éŸ³æ¨‚
        if (backgroundMusic.muted) {
            backgroundMusic.muted = false; // å˜—è©¦å–æ¶ˆéœéŸ³
            backgroundMusic.play().catch(error => {
                console.log('éŸ³æ¨‚æ’­æ”¾å¤±æ•— (æŠ½ç±¤æ™‚):', error);
                // é€™è£¡ä¸å½ˆå‡ºæç¤ºï¼Œé¿å…æ‰“æ–·ä½¿ç”¨è€…æ“ä½œ
            });
            musicToggleBtn.textContent = 'ğŸ”‡ éŸ³æ¨‚é—œ';
            isMusicPlaying = true;
        }

        document.getElementById('drawButton').disabled = true;
        document.getElementById('retryNumberButton').disabled = true;
        document.getElementById('result').innerHTML = '';
        document.getElementById('areaReel').innerText = '--';
        document.getElementById('numberReel').innerText = '--';
        spinAreaFirst();
      }

      function spinAreaFirst() {
        const availableAreas = areaNames.filter(area => {
          if (!drawnMap[area]) return true;
          // æª¢æŸ¥æ˜¯å¦é‚„æœ‰æœªæŠ½çš„è™Ÿç¢¼
          return areaMap[area].filter(n => !drawnMap[area].includes(n)).length > 0;
        });


        if (availableAreas.length === 0) {
          alert("æ‰€æœ‰å€åŸŸç·¨è™Ÿéƒ½æŠ½å®Œäº†ï¼Œè«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€é‡æ–°æŠ½é¸ï¼");
          document.getElementById('drawButton').disabled = false;
          return;
        }

        const areaReel = document.getElementById('areaReel');
        let spinDuration = 2000 + Math.random() * 1000;
        let start = null;

        function animate(time) {
          if (!start) start = time;
          const progress = time - start;
          const i = Math.floor(progress / 80) % availableAreas.length;
          areaReel.innerText = availableAreas[i];

          if (progress < spinDuration) {
            requestAnimationFrame(animate);
          } else {
            const finalArea = availableAreas[Math.floor(Math.random() * availableAreas.length)];
            areaReel.innerText = finalArea;
            lastSelectedArea = finalArea;
            spinNumber(finalArea);
          }
        }

        requestAnimationFrame(animate);
      }

      function spinNumber(area) {
        const allNumbers = areaMap[area];
        const numberReel = document.getElementById('numberReel');

        if (!allNumbers || allNumbers.length === 0) {
          numberReel.innerText = 'ç„¡è³‡æ–™';
          document.getElementById('result').innerHTML = `âš ï¸ <b>${area}</b> æ²’æœ‰å¯æŠ½å–çš„ç·¨è™Ÿã€‚è«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€é‡ç½®æˆ–é¸æ“‡å…¶ä»–å€åŸŸã€‚`;
          document.getElementById('drawButton').disabled = false;
          document.getElementById('retryNumberButton').disabled = true;
          return;
        }

        if (!drawnMap[area]) drawnMap[area] = [];

        const remainingNumbers = allNumbers.filter(n => !drawnMap[area].includes(n));

        if (remainingNumbers.length === 0) {
          numberReel.innerText = 'å·²æŠ½å®Œ';
          document.getElementById('result').innerHTML = `âš ï¸ <b>${area}</b> çš„ç·¨è™Ÿå·²å…¨éƒ¨æŠ½å®Œï¼Œè«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€é‡ç½®`;
          document.getElementById('drawButton').disabled = false;
          document.getElementById('retryNumberButton').disabled = true;
          return;
        }

        let spinDuration = 2000 + Math.random() * 1000;
        let start = null;

        function animate(time) {
          if (!start) start = time;
          const progress = time - start;
          const i = Math.floor(progress / 80) % remainingNumbers.length;
          numberReel.innerText = remainingNumbers[i];

          if (progress < spinDuration) {
            requestAnimationFrame(animate);
          } else {
            const finalNumber = remainingNumbers[Math.floor(Math.random() * remainingNumbers.length)];
            numberReel.innerText = finalNumber;
            drawnMap[area].push(finalNumber);

            document.getElementById('result').innerHTML = `
              ğŸ‘‰ é¸ä¸­å–®ä½ï¼š<b>${area}</b><br>
              ğŸ‘‰ å€ï¼š<b>${finalNumber}</b>
            `;

            document.getElementById('history').innerHTML += `
              <div>ğŸ”¹ <b>${area}</b> <b>${finalNumber}</b></div>
            `;

            document.getElementById('drawButton').disabled = false;
            document.getElementById('retryNumberButton').disabled = false;
          }
        }

        requestAnimationFrame(animate);
      }

      function retryNumber() {
        if (!lastSelectedArea) {
          alert("è«‹å…ˆæŠ½å‡ºä¸€å€‹å€åŸŸï¼");
          return;
        }
        document.getElementById('result').innerHTML = '';
        document.getElementById('numberReel').innerText = '--';
        document.getElementById('drawButton').disabled = true;
        document.getElementById('retryNumberButton').disabled = true;
        spinNumber(lastSelectedArea);
      }

      function resetHistory() {
        document.getElementById('history').innerHTML = '<strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong>';
      }

      function restartAll() {
        drawnMap = {};
        lastSelectedArea = null;
        document.getElementById('areaReel').innerText = '--';
        document.getElementById('numberReel').innerText = '--';
        document.getElementById('result').innerHTML = '';
        document.getElementById('history').innerHTML = '<strong>ğŸ¯ æŠ½é¸ç´€éŒ„ï¼š</strong>';
        document.getElementById('drawButton').disabled = false;
        document.getElementById('retryNumberButton').disabled = true;
        alert("æ‰€æœ‰è³‡æ–™å·²é‡ç½®ï¼Œé‡æ–°é–‹å§‹æŠ½é¸ï¼");
      }
    </script>
  </body>
</html>
